#!/bin/sh

echo "ğŸ“„ Verifying OpenAPI spec is up to date..."
npm run openapi:generate

if [ $? -ne 0 ]; then
  echo "âŒ OpenAPI generation failed! Push aborted."
  exit 1
fi

if ! git diff --quiet -- public/openapi.yaml; then
  echo "âŒ public/openapi.yaml is outdated."
  echo "   Run: npm run openapi:generate"
  echo "   Then commit: git add public/openapi.yaml && git commit"
  exit 1
fi

echo "ğŸ”¨ Running build check before push..."
npm run build

if [ $? -ne 0 ]; then
  echo "âŒ Build failed! Push aborted."
  exit 1
fi

echo "âœ… Build successful! Proceeding with push."
